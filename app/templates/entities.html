{% extends "base.html" %}

{% block content %}
<div class="container">
  <h1>Select Configuration</h1>
  <h2>Define Entity Requirements</h2>
  <div class="config-section">
    <table id="entityTable" border="1" style="width: 100%; border-collapse: collapse; background-color: #111; color: white; border-color: #333;">
      <thead>
        <tr style="background-color: #222;">
          <th>Category</th>
          <th>Entity</th>
          <th>Placement</th>
          <th>Quantity</th>
          <th>Depends On</th>
          <th>Within Zone</th>
          <th>Remove</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><input type="text" class="input-cell" style="width: 100%;" placeholder="eg: Storage, Machinery"></td>
          <td><input type="text" class="input-cell" style="width: 100%;" placeholder="eg: Shelf, Station"></td>
          <td>
            <select style="width: 100%; padding: 0; margin: 0;">
              <option value="Auto">Auto</option>
              <option value="Manual">Manual</option>
            </select>
          </td>
          <td><input type="number" class="input-cell" min="1" style="width: 100%; ..."></td>
          <td>
            <select style="width: 100%; padding: 0; margin: 0;">
              <option value="none">None</option>
            </select>
          </td>
          <td>
            <select style="width: 100%; padding: 0; margin: 0;">
              <option value="none">None</option>
            </select>
          </td>
          <td><button type="button" class="remove-btn" style="background-color: #111; color:white; width: 100%;">X</button></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="proceed-button-container">
    <button type="submit" class="button">Proceed</button>
</div>
</div>
{% endblock %}

{% block scripts %}
<script>
const table = document.getElementById("entityTable").getElementsByTagName("tbody")[0];

function isRowFilled(row) {
  const inputs = row.querySelectorAll("input, select");
  return Array.from(inputs).every(input => input.value !== "");
}

function createRow() {
  const newRow = document.createElement("tr");

  newRow.innerHTML = `
  <td><input type="text" class="input-cell" style="width: 100%;" placeholder="eg: Storage, Machinery"></td>
  <td><input type="text" class="input-cell" style="width: 100%;" placeholder="eg: Shelf, Station"></td>
          <td>
            <select style="width: 100%; padding: 0; margin: 0;">
              <option value="Auto">Auto</option>
              <option value="Manual">Manual</option>
            </select>
          </td>
          <td><input type="number" class="input-cell" min="1" style="width: 100%; ..."></td>
          <td>
            <select style="width: 100%; padding: 0; margin: 0;">
              <option value="none">None</option>
            </select>
          </td>
          <td>
            <select style="width: 100%; padding: 0; margin: 0;">
              <option value="none">None</option>
            </select>
          </td>
          <td><button type="button" class="remove-btn" style="background-color: #111; color:white; width: 100%;">X</button></td>
  `;

  return newRow;
}

function addRowIfLastFilled() {
  const rows = table.querySelectorAll("tr");
  const lastRow = rows[rows.length - 1];
  if (isRowFilled(lastRow)) {
    const newRow = createRow();
    table.appendChild(newRow);
  }
}

table.addEventListener("input", addRowIfLastFilled);

table.addEventListener("click", (e) => {
  if (e.target.classList.contains("remove-btn")) {
    const row = e.target.closest("tr");
    if (table.rows.length > 1) {
      row.remove();
    } else {
      alert("You must have at least one row.");
    }
  }
});
</script>
{% endblock %}
