{% extends "base.html" %}

{% block content %}
<div class="container">
  <h1>Optimiser Configuration</h1>
  <h2>Select Optimisation Components</h2>
  
  <form id="optimiserForm" method="POST" action="/optimiser">
    <div class="config-grid">
      <div class="config-section">
        <h3>Algorithm Selection</h3>
        <select name="algorithm" required>
          <option value="ga">Genetic Algorithm</option>
          <option value="rl">Reinforcement Learning</option>
          <option value="gasim">Genetic Algorithm + Simulation</option>
        </select>
        
        <div class="parameter-section">
          <h4>Population Size</h4>
          <input type="number" name="population_size" min="10" max="100" value="30">
        </div>
        
        <div class="parameter-section">
          <h4>Generations</h4>
          <input type="number" name="generations" min="10" max="1000" value="50">
        </div>
      </div>

      <div class="config-section">
        <h3>Fitness Function</h3>
        <select name="fitness_function" required>
          <option value="standard_layout_fitness">Standard Layout Fitness</option>
          <option value="custom_fitness">Custom Fitness</option>
        </select>
        
        <div class="parameter-section">
          <h4>Weights</h4>
          <div class="weight-inputs">
            <label>Travel Distance:</label>
            <input type="range" name="weight_travel" min="0" max="1" step="0.1" value="0.3">
            <span class="weight-value">0.3</span>
          </div>
          <div class="weight-inputs">
            <label>Congestion Risk:</label>
            <input type="range" name="weight_congestion" min="0" max="1" step="0.1" value="0.3">
            <span class="weight-value">0.3</span>
          </div>
          <div class="weight-inputs">
            <label>Turns:</label>
            <input type="range" name="weight_turns" min="0" max="1" step="0.1" value="0.2">
            <span class="weight-value">0.2</span>
          </div>
          <div class="weight-inputs">
            <label>Simulation Score:</label>
            <input type="range" name="weight_simulation" min="0" max="1" step="0.1" value="0.2">
            <span class="weight-value">0.2</span>
          </div>
        </div>
      </div>

      <div class="config-section">
        <h3>Simulation Settings</h3>
        <select name="simulation" required>
          <option value="mesa_warehouse_sim">Mesa Warehouse Simulation</option>
          <option value="custom_sim">Custom Simulation</option>
        </select>
        
        <div class="parameter-section">
          <h4>Simulation Parameters</h4>
          <div class="sim-inputs">
            <label>Number of Agents:</label>
            <input type="number" name="num_agents" min="1" max="20" value="5">
          </div>
          <div class="sim-inputs">
            <label>Max Steps:</label>
            <input type="number" name="max_steps" min="100" max="10000" value="1000">
          </div>
          <div class="sim-inputs">
            <label>Simulation Threshold:</label>
            <input type="range" name="sim_threshold" min="0" max="1" step="0.1" value="0.8">
            <span class="sim-value">0.8</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="proceed-button-container">
      <button type="submit" class="button">Start Optimisation</button>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script>
// Update weight values display
document.querySelectorAll('input[type="range"]').forEach(input => {
  const valueSpan = input.nextElementSibling;
  input.addEventListener('input', () => {
    valueSpan.textContent = input.value;
  });
});

// Validate weights sum to 1
document.getElementById('optimiserForm').addEventListener('submit', function(e) {
  const weights = [
    parseFloat(document.querySelector('input[name="weight_travel"]').value),
    parseFloat(document.querySelector('input[name="weight_congestion"]').value),
    parseFloat(document.querySelector('input[name="weight_turns"]').value),
    parseFloat(document.querySelector('input[name="weight_simulation"]').value)
  ];
  
  const sum = weights.reduce((a, b) => a + b, 0);
  if (Math.abs(sum - 1) > 0.01) {
    alert('Weights must sum to 1. Current sum: ' + sum.toFixed(2));
    e.preventDefault();
  }
});
</script>
{% endblock %} 